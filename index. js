app.post("/webhook", (req, res) => {
  console.log("Dialogflow request body:", JSON.stringify(req.body, null, 2));

  const intent = req.body.queryResult.intent.displayName;
  const parameters = req.body.queryResult.parameters;

  if (intent === "GiveAttendance") {
    // ✅ use your custom entity parameter name
    const roll = parameters["roll_number"];  

    if (!roll) {
      return res.json({
        fulfillmentText: "Please provide a roll number to check attendance."
      });
    }

    const percentage = attendanceData[roll];

    if (percentage !== undefined) {
      return res.json({
        fulfillmentText: `The attendance percentage for roll number ${roll} is ${percentage}%.`
      });
    } else {
      return res.json({
        fulfillmentText: `I don’t have attendance data for roll number ${roll}.`
      });
    }
  }

  // Default fallback
  res.json({
    fulfillmentText: "Sorry, I didn’t understand that."
  });
});
